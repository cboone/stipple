# v0.3.0: Rectangle Drawing Implementation Plan

## Overview

Add rectangle drawing (outline and filled) for rendering wall faces in the Maze Wars TUI game.

## Files to Create/Modify

1. **Create** `draw/rectangle.go` - Rectangle and RectangleFilled functions
2. **Create** `draw/rectangle_test.go` - Tests with visual flag support
3. **Modify** `examples/demo/main.go` - Add rectangle demonstrations

---

## 1. `draw/rectangle.go`

### Function Signatures

```go
package draw

import "github.com/cboone/brodot/canvas"

// Rectangle draws a rectangle outline from (x, y) with the given width and height.
// The rectangle's top-left corner is at (x, y), extending to (x+width-1, y+height-1).
// Width or height of 0 or negative draws nothing.
func Rectangle(c *canvas.Canvas, x, y, width, height float64)

// RectangleFilled draws a filled rectangle from (x, y) with the given width and height.
// The rectangle's top-left corner is at (x, y), extending to (x+width-1, y+height-1).
// Width or height of 0 or negative draws nothing.
func RectangleFilled(c *canvas.Canvas, x, y, width, height float64)
```

### Implementation Details

#### `Rectangle` (Outline)

Uses the existing `Line` function for the four edges:

```go
func Rectangle(c *canvas.Canvas, x, y, width, height float64) {
    if width <= 0 || height <= 0 {
        return
    }

    // Calculate corner coordinates
    // Top-left: (x, y)
    // Top-right: (x + width - 1, y)
    // Bottom-left: (x, y + height - 1)
    // Bottom-right: (x + width - 1, y + height - 1)
    right := x + width - 1
    bottom := y + height - 1

    // Draw four edges using Line
    Line(c, x, y, right, y)           // Top edge
    Line(c, right, y, right, bottom)  // Right edge
    Line(c, right, bottom, x, bottom) // Bottom edge
    Line(c, x, bottom, x, y)          // Left edge
}
```

**Edge handling notes:**
- Using `width - 1` and `height - 1` ensures the rectangle is exactly `width` pixels wide and `height` pixels tall
- Corners are included by the Line function (endpoints are always set)
- Lines connect at corners, which is fine since Set is idempotent

#### `RectangleFilled`

Iterates row by row, setting all pixels:

```go
func RectangleFilled(c *canvas.Canvas, x, y, width, height float64) {
    if width <= 0 || height <= 0 {
        return
    }

    // Convert to integers for iteration
    startX := int(math.Floor(x))
    startY := int(math.Floor(y))
    endX := int(math.Floor(x + width - 1))  // inclusive
    endY := int(math.Floor(y + height - 1)) // inclusive

    // Set all pixels in the rectangle
    for pixelY := startY; pixelY <= endY; pixelY++ {
        for pixelX := startX; pixelX <= endX; pixelX++ {
            c.Set(float64(pixelX), float64(pixelY))
        }
    }
}
```

**Design decisions:**
- Uses `math.Floor` for coordinate conversion (consistent with canvas and line)
- Iterates `[startX, endX]` and `[startY, endY]` so a rectangle at (0, 0) with width=10, height=10 fills pixels 0-9
- Out-of-bounds pixels are silently ignored by `c.Set()` - no bounds checking needed here

---

## 2. `draw/rectangle_test.go`

### Test Cases

Tests use shared helpers from `draw/test_helpers_test.go` which provides `visualFlag`, `TestMain`, and `printVisual` for all draw package tests.

```go
package draw

import (
    "testing"

    "github.com/cboone/brodot/canvas"
)
```

#### Test Functions

1. **`TestRectangle`** - Verify outline pixels are set, interior is not
   - Create 20x16 canvas
   - Draw Rectangle at (2, 2) with width=10, height=8
   - Verify all edge pixels (x=2, x=11, y=2, y=9) are set
   - Verify interior pixels (3-10, 3-8) are NOT set
   - Print visual output

2. **`TestRectangleFilled`** - Verify all interior pixels are set
   - Create 20x16 canvas
   - Draw RectangleFilled at (2, 2) with width=10, height=8
   - Verify ALL pixels in range (2-11, 2-9) are set
   - Verify pixels outside rectangle are NOT set
   - Print visual output

3. **`TestRectangleZeroSize`** - Zero width or height draws nothing
   - Test width=0, height>0: no pixels set
   - Test width>0, height=0: no pixels set
   - Test width=0, height=0: no pixels set
   - Test negative width and height: no pixels set

4. **`TestRectanglePartiallyOffCanvas`** - Rectangle extending beyond bounds is clipped
   - Create 20x16 canvas
   - Draw outline rectangle starting at (-5, -5) with width=15, height=15
   - Verify only the on-canvas portion is drawn (0-9, 0-9) on edges
   - Print visual output

5. **`TestRectangleFilledPartiallyOffCanvas`** - Filled rectangle extending beyond bounds is clipped
   - Create 20x16 canvas
   - Draw filled rectangle starting at (-5, -5) with width=15, height=15
   - Verify only the on-canvas portion is drawn (0-9, 0-9)
   - Print visual output

6. **`TestRectangleSmall`** - Edge case: 1x1, 2x2, etc.
   - 1x1 rectangle: single pixel at (x, y)
   - 2x2 outline: 4 corner pixels only
   - 2x2 filled: all 4 pixels

7. **`TestRectangleFilledFloatCoordinates`** - Verify floor behavior
   - Filled rectangle at (2.7, 3.9) should start at (2, 3)
   - Width/height with fractional parts floor correctly

---

## 3. `examples/demo/main.go` Updates

Add rectangle demonstrations after the existing line demonstrations (currently ends with the print label `"11. Star pattern (multiple lines):"`):

```go
// 12. Rectangle outline
fmt.Println("12. Rectangle outline:")
c12 := canvas.New(40, 20)
draw.Rectangle(c12, 5, 2, 30, 16)
fmt.Println(c12.Frame())
fmt.Println()

// 13. Filled rectangle
fmt.Println("13. Filled rectangle:")
c13 := canvas.New(40, 20)
draw.RectangleFilled(c13, 5, 2, 30, 16)
fmt.Println(c13.Frame())
fmt.Println()

// 14. Multiple rectangles (nested)
fmt.Println("14. Nested rectangles:")
c14 := canvas.New(40, 24)
draw.Rectangle(c14, 2, 2, 36, 20)
draw.Rectangle(c14, 6, 4, 28, 16)
draw.Rectangle(c14, 10, 6, 20, 12)
draw.Rectangle(c14, 14, 8, 12, 8)
fmt.Println(c14.Frame())
fmt.Println()

// 15. Wall-like rectangles (Maze Wars preview)
fmt.Println("15. Wall-like rectangles (Maze Wars preview):")
c15 := canvas.New(60, 32)
// Far wall (small, centered)
draw.RectangleFilled(c15, 20, 8, 20, 16)
// Side walls (trapezoid approximation with rectangles)
draw.Rectangle(c15, 5, 2, 50, 28)
fmt.Println(c15.Frame())
```

---

## Verification Steps

### 1. Run Tests

```bash
go test ./draw/... -v
```

All tests should pass.

### 2. Visual Test Verification

```bash
go test ./draw/... -v -args -visual
```

Inspect output to verify:
- Rectangle outlines show only edge pixels
- Filled rectangles show solid blocks
- Clipping works correctly for off-canvas portions

### 3. Run Demo

```bash
go run ./examples/demo/
```

Verify visual output matches expectations:
- Rectangle outline is visible and rectangular
- Filled rectangle appears as a solid block
- Nested rectangles show concentric outlines
- Wall preview demonstrates Maze Wars use case

---

## Implementation Order

1. Create `draw/rectangle.go` with both functions
2. Create `draw/rectangle_test.go` with all tests
3. Run tests to verify implementation
4. Update `examples/demo/main.go` with demonstrations
5. Run demo to verify visual output
6. Update `docs/plans/PLAN.md` to mark v0.3.0 deliverables complete

---

## Edge Cases to Handle

| Case | Behavior |
|------|----------|
| width <= 0 | Draw nothing |
| height <= 0 | Draw nothing |
| Negative x, y | Clipped by canvas (silent) |
| Extends beyond canvas | Clipped by canvas (silent) |
| Float coordinates | Floored to integers |
| 1x1 rectangle | Single pixel |
| Outline 2x2 | 4 pixels (corners only) |
| Filled 2x2 | 4 pixels (all) |
